"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/defineProperty"),t=require("three");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=n(e);class a extends t.EventDispatcher{constructor(e,n){super(),o.default(this,"object",void 0),o.default(this,"domElement",void 0),o.default(this,"enabled",!0),o.default(this,"target",new t.Vector3),o.default(this,"minDistance",0),o.default(this,"maxDistance",1/0),o.default(this,"minZoom",0),o.default(this,"maxZoom",1/0),o.default(this,"minPolarAngle",0),o.default(this,"maxPolarAngle",Math.PI),o.default(this,"minAzimuthAngle",-1/0),o.default(this,"maxAzimuthAngle",1/0),o.default(this,"enableDamping",!1),o.default(this,"dampingFactor",.05),o.default(this,"enableZoom",!0),o.default(this,"zoomSpeed",1),o.default(this,"enableRotate",!0),o.default(this,"rotateSpeed",1),o.default(this,"enablePan",!0),o.default(this,"panSpeed",1),o.default(this,"screenSpacePanning",!0),o.default(this,"keyPanSpeed",7),o.default(this,"autoRotate",!1),o.default(this,"autoRotateSpeed",2),o.default(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),o.default(this,"mouseButtons",{LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN}),o.default(this,"touches",{ONE:t.TOUCH.ROTATE,TWO:t.TOUCH.DOLLY_PAN}),o.default(this,"target0",void 0),o.default(this,"position0",void 0),o.default(this,"zoom0",void 0),o.default(this,"_domElementKeyEvents",null),o.default(this,"getPolarAngle",void 0),o.default(this,"getAzimuthalAngle",void 0),o.default(this,"listenToKeyEvents",void 0),o.default(this,"saveState",void 0),o.default(this,"reset",void 0),o.default(this,"update",void 0),o.default(this,"connect",void 0),o.default(this,"dispose",void 0),this.object=e,this.domElement=n,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object instanceof t.PerspectiveCamera?this.object.zoom:1,this.getPolarAngle=()=>d.phi,this.getAzimuthalAngle=()=>d.theta,this.listenToKeyEvents=e=>{e.addEventListener("keydown",Z),this._domElementKeyEvents=e},this.saveState=()=>{a.target0.copy(a.target),a.position0.copy(a.object.position),a.zoom0=a.object instanceof t.PerspectiveCamera?a.object.zoom:1},this.reset=()=>{a.target.copy(a.target0),a.object.position.copy(a.position0),a.object instanceof t.PerspectiveCamera&&(a.object.zoom=a.zoom0,a.object.updateProjectionMatrix()),a.dispatchEvent(i),a.update(),l=r.NONE},this.update=(()=>{const n=new t.Vector3,o=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),s=o.clone().invert(),c=new t.Vector3,b=new t.Quaternion,E=2*Math.PI;return function(){const e=a.object.position;n.copy(e).sub(a.target),n.applyQuaternion(o),d.setFromVector3(n),a.autoRotate&&l===r.NONE&&L(2*Math.PI/60/60*a.autoRotateSpeed),a.enableDamping?(d.theta+=h.theta*a.dampingFactor,d.phi+=h.phi*a.dampingFactor):(d.theta+=h.theta,d.phi+=h.phi);let t=a.minAzimuthAngle,v=a.maxAzimuthAngle;return isFinite(t)&&isFinite(v)&&(t<-Math.PI?t+=E:t>Math.PI&&(t-=E),v<-Math.PI?v+=E:v>Math.PI&&(v-=E),d.theta=t<=v?Math.max(t,Math.min(v,d.theta)):d.theta>(t+v)/2?Math.max(t,d.theta):Math.min(v,d.theta)),d.phi=Math.max(a.minPolarAngle,Math.min(a.maxPolarAngle,d.phi)),d.makeSafe(),d.radius*=m,d.radius=Math.max(a.minDistance,Math.min(a.maxDistance,d.radius)),!0===a.enableDamping?a.target.addScaledVector(p,a.dampingFactor):a.target.add(p),n.setFromSpherical(d),n.applyQuaternion(s),e.copy(a.target).add(n),a.object.lookAt(a.target),!0===a.enableDamping?(h.theta*=1-a.dampingFactor,h.phi*=1-a.dampingFactor,p.multiplyScalar(1-a.dampingFactor)):(h.set(0,0,0),p.set(0,0,0)),m=1,!!(f||c.distanceToSquared(a.object.position)>u||8*(1-b.dot(a.object.quaternion))>u)&&(a.dispatchEvent(i),c.copy(a.object.position),b.copy(a.object.quaternion),f=!1,!0)}})(),this.connect=e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),a.domElement=e,a.domElement.addEventListener("contextmenu",q),a.domElement.addEventListener("pointerdown",z),a.domElement.addEventListener("wheel",F),a.domElement.addEventListener("touchstart",K),a.domElement.addEventListener("touchend",G),a.domElement.addEventListener("touchmove",B)},this.dispose=()=>{var e,t,n,o,i,s,c,r;null===(e=a.domElement)||void 0===e||e.removeEventListener("contextmenu",q),null===(t=a.domElement)||void 0===t||t.removeEventListener("pointerdown",z),null===(n=a.domElement)||void 0===n||n.removeEventListener("wheel",F),null===(o=a.domElement)||void 0===o||o.removeEventListener("touchstart",K),null===(i=a.domElement)||void 0===i||i.removeEventListener("touchend",G),null===(s=a.domElement)||void 0===s||s.removeEventListener("touchmove",B),null===(c=a.domElement)||void 0===c||c.ownerDocument.removeEventListener("pointermove",I),null===(r=a.domElement)||void 0===r||r.ownerDocument.removeEventListener("pointerup",X),null!==a._domElementKeyEvents&&a._domElementKeyEvents.removeEventListener("keydown",Z)};const a=this,i={type:"change"},s={type:"start"},c={type:"end"},r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=r.NONE;const u=1e-6,d=new t.Spherical,h=new t.Spherical;let m=1;const p=new t.Vector3;let f=!1;const b=new t.Vector2,E=new t.Vector2,v=new t.Vector2,g=new t.Vector2,O=new t.Vector2,T=new t.Vector2,P=new t.Vector2,y=new t.Vector2,A=new t.Vector2;function w(){return Math.pow(.95,a.zoomSpeed)}function L(e){h.theta-=e}function j(e){h.phi-=e}const N=(()=>{const e=new t.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),p.add(e)}})(),M=(()=>{const e=new t.Vector3;return function(t,n){!0===a.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(a.object.up,e)),e.multiplyScalar(t),p.add(e)}})(),C=(()=>{const e=new t.Vector3;return function(n,o){const i=a.domElement;if(i&&a.object instanceof t.PerspectiveCamera&&a.object.isPerspectiveCamera){const t=a.object.position;e.copy(t).sub(a.target);let s=e.length();s*=Math.tan(a.object.fov/2*Math.PI/180),N(2*n*s/i.clientHeight,a.object.matrix),M(2*o*s/i.clientHeight,a.object.matrix)}else i&&a.object instanceof t.OrthographicCamera&&a.object.isOrthographicCamera?(N(n*(a.object.right-a.object.left)/a.object.zoom/i.clientWidth,a.object.matrix),M(o*(a.object.top-a.object.bottom)/a.object.zoom/i.clientHeight,a.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),a.enablePan=!1)}})();function D(e){a.object instanceof t.PerspectiveCamera&&a.object.isPerspectiveCamera?m/=e:a.object instanceof t.OrthographicCamera&&a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom*e)),a.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function R(e){a.object instanceof t.PerspectiveCamera&&a.object.isPerspectiveCamera?m*=e:a.object instanceof t.OrthographicCamera&&a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/e)),a.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function S(e){b.set(e.clientX,e.clientY)}function Y(e){g.set(e.clientX,e.clientY)}function k(e){if(1==e.touches.length)b.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(t,n)}}function x(e){if(1==e.touches.length)g.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(t,n)}}function H(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);P.set(0,o)}function U(e){if(1==e.touches.length)E.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);E.set(t,n)}v.subVectors(E,b).multiplyScalar(a.rotateSpeed);const t=a.domElement;t&&(L(2*Math.PI*v.x/t.clientHeight),j(2*Math.PI*v.y/t.clientHeight)),b.copy(E)}function _(e){if(1==e.touches.length)O.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);O.set(t,n)}T.subVectors(O,g).multiplyScalar(a.panSpeed),C(T.x,T.y),g.copy(O)}function V(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);y.set(0,o),A.set(0,Math.pow(y.y/P.y,a.zoomSpeed)),D(A.y),P.copy(y)}function z(e){if(!1!==a.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){var n;let o;switch(e.preventDefault(),null!==(n=a.domElement)&&void 0!==n&&n.focus?a.domElement.focus():window.focus(),e.button){case 0:o=a.mouseButtons.LEFT;break;case 1:o=a.mouseButtons.MIDDLE;break;case 2:o=a.mouseButtons.RIGHT;break;default:o=-1}switch(o){case t.MOUSE.DOLLY:if(!1===a.enableZoom)return;!function(e){P.set(e.clientX,e.clientY)}(e),l=r.DOLLY;break;case t.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===a.enablePan)return;Y(e),l=r.PAN}else{if(!1===a.enableRotate)return;S(e),l=r.ROTATE}break;case t.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===a.enableRotate)return;S(e),l=r.ROTATE}else{if(!1===a.enablePan)return;Y(e),l=r.PAN}break;default:l=r.NONE}if(l!==r.NONE){var i,c;null===(i=a.domElement)||void 0===i||i.ownerDocument.addEventListener("pointermove",I),null===(c=a.domElement)||void 0===c||c.ownerDocument.addEventListener("pointerup",X),a.dispatchEvent(s)}}(e)}}function I(e){if(!1!==a.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===a.enabled)return;switch(e.preventDefault(),l){case r.ROTATE:if(!1===a.enableRotate)return;!function(e){E.set(e.clientX,e.clientY),v.subVectors(E,b).multiplyScalar(a.rotateSpeed);const t=a.domElement;t&&(L(2*Math.PI*v.x/t.clientHeight),j(2*Math.PI*v.y/t.clientHeight)),b.copy(E),a.update()}(e);break;case r.DOLLY:if(!1===a.enableZoom)return;!function(e){y.set(e.clientX,e.clientY),A.subVectors(y,P),A.y>0?D(w()):A.y<0&&R(w()),P.copy(y),a.update()}(e);break;case r.PAN:if(!1===a.enablePan)return;!function(e){O.set(e.clientX,e.clientY),T.subVectors(O,g).multiplyScalar(a.panSpeed),C(T.x,T.y),g.copy(O),a.update()}(e)}}(e)}}function X(e){switch(e.pointerType){case"mouse":case"pen":!function(){var e,t;if(null===(e=a.domElement)||void 0===e||e.ownerDocument.removeEventListener("pointermove",I),null===(t=a.domElement)||void 0===t||t.ownerDocument.removeEventListener("pointerup",X),!1===a.enabled)return;a.dispatchEvent(c),l=r.NONE}()}}function F(e){!1===a.enabled||!1===a.enableZoom||l!==r.NONE&&l!==r.ROTATE||(e.preventDefault(),a.dispatchEvent(s),function(e){e.deltaY<0?R(w()):e.deltaY>0&&D(w()),a.update()}(e),a.dispatchEvent(c))}function Z(e){!1!==a.enabled&&!1!==a.enablePan&&function(e){let t=!1;switch(e.code){case a.keys.UP:C(0,a.keyPanSpeed),t=!0;break;case a.keys.BOTTOM:C(0,-a.keyPanSpeed),t=!0;break;case a.keys.LEFT:C(a.keyPanSpeed,0),t=!0;break;case a.keys.RIGHT:C(-a.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),a.update())}(e)}function K(e){if(!1!==a.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(a.touches.ONE){case t.TOUCH.ROTATE:if(!1===a.enableRotate)return;k(e),l=r.TOUCH_ROTATE;break;case t.TOUCH.PAN:if(!1===a.enablePan)return;x(e),l=r.TOUCH_PAN;break;default:l=r.NONE}break;case 2:switch(a.touches.TWO){case t.TOUCH.DOLLY_PAN:if(!1===a.enableZoom&&!1===a.enablePan)return;!function(e){a.enableZoom&&H(e),a.enablePan&&x(e)}(e),l=r.TOUCH_DOLLY_PAN;break;case t.TOUCH.DOLLY_ROTATE:if(!1===a.enableZoom&&!1===a.enableRotate)return;!function(e){a.enableZoom&&H(e),a.enableRotate&&k(e)}(e),l=r.TOUCH_DOLLY_ROTATE;break;default:l=r.NONE}break;default:l=r.NONE}l!==r.NONE&&a.dispatchEvent(s)}}function B(e){if(!1!==a.enabled)switch(e.preventDefault(),l){case r.TOUCH_ROTATE:if(!1===a.enableRotate)return;U(e),a.update();break;case r.TOUCH_PAN:if(!1===a.enablePan)return;_(e),a.update();break;case r.TOUCH_DOLLY_PAN:if(!1===a.enableZoom&&!1===a.enablePan)return;!function(e){a.enableZoom&&V(e),a.enablePan&&_(e)}(e),a.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===a.enableZoom&&!1===a.enableRotate)return;!function(e){a.enableZoom&&V(e),a.enableRotate&&U(e)}(e),a.update();break;default:l=r.NONE}}function G(){!1!==a.enabled&&(a.dispatchEvent(c),l=r.NONE)}function q(e){!1!==a.enabled&&e.preventDefault()}void 0!==n&&this.connect(n),this.update()}}exports.MapControls=class extends a{constructor(e,n){super(e,n),this.screenSpacePanning=!1,this.mouseButtons.LEFT=t.MOUSE.PAN,this.mouseButtons.RIGHT=t.MOUSE.ROTATE,this.touches.ONE=t.TOUCH.PAN,this.touches.TWO=t.TOUCH.DOLLY_ROTATE}},exports.OrbitControls=a;
